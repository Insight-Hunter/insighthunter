import{j as e}from"./jsx-runtime.CyXy1Ci3.js";import{r as i}from"./index.CaZlGE7t.js";import{d as C,c as w,e as p}from"./index.XE5wI2It.js";/* empty css                          */function E({companyId:n}){const[x,l]=i.useState(!1),[d,k]=i.useState(!1),[f,t]=i.useState(null),[c,u]=i.useState(null),h="http://localhost:8787";i.useEffect(()=>{const s=localStorage.getItem(`qb-connected-${n}`);if(s){const{connected:r,realmId:o}=JSON.parse(s);l(r),u(o)}},[n]);const b=i.useCallback((s,r)=>{const o={connected:s,realmId:r||c};l(s),u(r||c),localStorage.setItem(`qb-connected-${n}`,JSON.stringify(o))},[n,c]),g=async()=>{try{t(null);const s=await fetch(`${h}/api/ledger/${n}/quickbooks/auth`);if(!s.ok)throw new Error("Auth URL fetch failed");const{authUrl:r}=await s.json(),o=window.open(r,"QuickBooks OAuth","width=800,height=600,noopener,noreferrer"),m=a=>{[window.location.origin,"http://localhost:8787","https://yourapp.com"].includes(a.origin)&&(a.data.type==="quickbooks-connected"?(b(!0,a.data.realmId),o&&o.close()):a.data.type==="quickbooks-error"&&(t(a.data.message),o&&o.close()))};return window.addEventListener("message",m),()=>window.removeEventListener("message",m)}catch(s){t("Connection failed. Check console."),console.error("QB Connect error:",s)}};i.useEffect(()=>{},[]);const j=async()=>{if(!c)return t("No company connected");k(!0),t(null);try{if(!(await fetch(`${h}/api/ledger/${n}/quickbooks/sync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({realmId:c})})).ok)throw new Error("Sync failed")}catch(s){t("Sync failed. Verify tokens."),console.error(s)}finally{k(!1)}},y=()=>{localStorage.removeItem(`qb-connected-${n}`),l(!1),u(null),fetch(`${h}/api/ledger/${n}/quickbooks/disconnect`,{method:"POST"})};return e.jsxs("div",{className:"quickbooks-connect",children:[e.jsxs("div",{className:"qb-header",children:[e.jsx("img",{src:"/quickbooks-logo.svg",alt:"QuickBooks",className:"qb-logo"}),e.jsx("h3",{children:"QuickBooks Integration"})]}),f&&e.jsxs("div",{className:"error-banner",children:[e.jsx(C,{})," ",f," ",e.jsx("button",{onClick:()=>t(null),children:"Dismiss"})]}),x?e.jsxs("div",{className:"qb-connected",children:[e.jsxs("div",{className:"status-badge success",children:[e.jsx(w,{})," Connected (Realm: ",c?.slice(-8),")"]}),e.jsxs("div",{className:"button-group",children:[e.jsxs("button",{onClick:j,disabled:d,className:"btn-secondary",children:[d?e.jsx(p,{className:"spinning"}):e.jsx(p,{})," ",d?"Syncing...":"Sync Now"]}),e.jsx("button",{onClick:y,className:"btn-outline",children:"Disconnect"})]})]}):e.jsxs("div",{className:"qb-connect",children:[e.jsx("p",{children:"Connect QuickBooks to sync: Chart of Accounts, Customers/Vendors, Invoices/Bills, Bank Transactions.[web:11][web:14]"}),e.jsx("button",{onClick:g,className:"btn-primary",children:"Connect to QuickBooks"})]}),e.jsxs("div",{className:"qb-features",children:[e.jsx("h4",{children:"Synced Data:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Chart of Accounts (GET /v3/company/",c,"/account)"]}),e.jsx("li",{children:"Customers & Vendors (Customer/Vendor endpoints)"}),e.jsx("li",{children:"Invoices & Bills (Invoice/Bill with LinkedTxn)"}),e.jsx("li",{children:"Bank Transactions (JournalEntry/Deposit)"}),e.jsx("li",{children:"Reports (query?query=SELECT * FROM Report)"})]})]})]})}export{E as default};

import{j as e}from"./jsx-runtime.CyXy1Ci3.js";import{r as o}from"./index.CaZlGE7t.js";import{F as v,a as g,b as w}from"./index.XE5wI2It.js";/* empty css                           */function T({transaction:c}){const[r,h]=o.useState(!1),u=c.entries.filter(n=>n.type==="debit").reduce((n,s)=>n+s.amount,0);return e.jsxs("div",{className:"transaction-row",children:[e.jsxs("div",{className:"transaction-summary",onClick:()=>h(!r),children:[e.jsxs("div",{className:"summary-left",children:[e.jsx("button",{className:"expand-btn",children:r?e.jsx(v,{}):e.jsx(g,{})}),e.jsxs("div",{children:[e.jsx("div",{className:"transaction-date",children:c.date}),e.jsx("div",{className:"transaction-description",children:c.description})]})]}),e.jsxs("div",{className:"transaction-amount",children:["$",u.toFixed(2)]})]}),r&&e.jsx("div",{className:"transaction-details",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Debit"}),e.jsx("th",{children:"Credit"})]})}),e.jsx("tbody",{children:c.entries.map((n,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.accountName}),e.jsx("td",{children:n.type==="debit"?`$${n.amount.toFixed(2)}`:"-"}),e.jsx("td",{children:n.type==="credit"?`$${n.amount.toFixed(2)}`:"-"})]},s))})]})})]})}function E({companyId:c}){const[r,h]=o.useState([]),[u,n]=o.useState(!1),[s,d]=o.useState({date:new Date().toISOString().split("T")[0],description:"",entries:[{accountId:"",accountName:"",type:"debit",amount:0},{accountId:"",accountName:"",type:"credit",amount:0}]}),m="http://localhost:8787";o.useEffect(()=>{j()},[]);async function j(){try{const a=await(await fetch(`${m}/api/ledger/${c}/transactions`)).json();h(a.transactions)}catch(t){console.error("Failed to load transactions:",t)}}async function y(){try{await fetch(`${m}/api/ledger/${c}/transaction`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n(!1),d({date:new Date().toISOString().split("T")[0],description:"",entries:[{accountId:"",accountName:"",type:"debit",amount:0},{accountId:"",accountName:"",type:"credit",amount:0}]}),j()}catch(t){console.error("Failed to create transaction:",t)}}function f(){d({...s,entries:[...s.entries,{accountId:"",accountName:"",type:"debit",amount:0}]})}function l(t,a,i){const x=[...s.entries];x[t]={...x[t],[a]:i},d({...s,entries:x})}const p=s.entries.filter(t=>t.type==="debit").reduce((t,a)=>t+Number(a.amount),0),b=s.entries.filter(t=>t.type==="credit").reduce((t,a)=>t+Number(a.amount),0),N=Math.abs(p-b)<.01;return e.jsxs("div",{className:"ledger-table",children:[e.jsxs("div",{className:"table-header",children:[e.jsx("h2",{children:"General Ledger"}),e.jsxs("button",{className:"btn-primary",onClick:()=>n(!0),children:[e.jsx(w,{})," New Transaction"]})]}),u&&e.jsxs("div",{className:"transaction-form",children:[e.jsx("h3",{children:"New Journal Entry"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"date",value:s.date,onChange:t=>d({...s,date:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Description",value:s.description,onChange:t=>d({...s,description:t.target.value})})]}),e.jsxs("table",{className:"entry-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Account"}),e.jsx("th",{children:"Debit"}),e.jsx("th",{children:"Credit"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s.entries.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"text",placeholder:"Account name",value:t.accountName,onChange:i=>l(a,"accountName",i.target.value)})}),e.jsx("td",{children:t.type==="debit"?e.jsx("input",{type:"number",step:"0.01",value:t.amount,onChange:i=>l(a,"amount",i.target.value)}):e.jsx("span",{className:"empty-cell",children:"-"})}),e.jsx("td",{children:t.type==="credit"?e.jsx("input",{type:"number",step:"0.01",value:t.amount,onChange:i=>l(a,"amount",i.target.value)}):e.jsx("span",{className:"empty-cell",children:"-"})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>l(a,"type",t.type==="debit"?"credit":"debit"),className:"btn-switch",children:"↔"})})]},a))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:"Totals"})}),e.jsx("td",{children:e.jsxs("strong",{children:["$",p.toFixed(2)]})}),e.jsx("td",{children:e.jsxs("strong",{children:["$",b.toFixed(2)]})}),e.jsx("td",{children:N?e.jsx("span",{className:"balanced",children:"✓"}):e.jsx("span",{className:"unbalanced",children:"✗"})})]})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{onClick:f,className:"btn-secondary",children:"+ Add Line"}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>n(!1),className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:y,className:"btn-primary",disabled:!N||!s.description,children:"Post Transaction"})]})]})]}),e.jsx("div",{className:"transactions-list",children:r.map(t=>e.jsx(T,{transaction:t},t.id))})]})}export{E as default};


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sign Up – InsightHunter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="signup.css" />
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <!-- Turnstile -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script src="signup.js" defer></script>

  <body class="ih-body">
    <header class="ih-header">
      <div class="ih-header-inner">
        <a href="/" class="ih-logo">InsightHunter</a>
        <nav class="ih-nav">
          <a href="/pricing.html">Pricing</a>
          <a href="/features">Features</a>
          <a href="/login" class="ih-link-muted">Log in</a>
          <a href="/signup" class="ih-btn ih-btn-outline">Get started</a>
        </nav>
      </div>
    </header>

    <main>
      <!-- HERO + SIGNUP -->
      <section class="ih-hero">
        <div class="ih-hero-left">
          <h1>Stop flying blind. Run your finances with clarity.</h1>
          <p>
            InsightHunter gives solo entrepreneurs, freelancers, and small firms
            CFO-level visibility, automated reporting, and the confidence to make
            smart decisions — starting free.
          </p>
          <ul class="ih-hero-list">
            <li>Real-time cash flow dashboards</li>
            <li>Compliance hub and automated reminders</li>
            <li>Client-ready reports in one click</li>
          </ul>
          <div class="ih-hero-meta">
            <span>✓ No credit card required</span>
            <span>✓ Free plan forever</span>
          </div>
        </div>

        <div class="ih-hero-right">
          <form class="ih-signup-card" id="signup-form" method="POST" action="/api/signup">
            <h2>Create your account</h2>
            <p class="ih-signup-subtitle">
              Start on the Free plan. Upgrade only when you're ready.
            </p>

            <label class="ih-field">
              <span>Work email</span
              <input
                type="email"
                name="email"
                autocomplete="email"
                required
                placeholder="you@firmname.com"
              />
            </label>

            <label class="ih-field">
              <span>Password</span>
              <input
                type="password"
                name="password"
                autocomplete="new-password"
                required
                minlength="12"
                placeholder="At least 12 characters"
              />
              <small class="ih-field-help">
                Use at least 12 characters, including a number and symbol.
              </small>
            </label>

            <label class="ih-field">
              <span>Account type</span>
              <select name="role" required>
                <option value="">Select one</option>
                <option value="owner">Business owner</option>
                <option value="accountant">Accounting firm</option>
                <option value="fractional_cfo">Fractional CFO</option>
                <option value="other">Other</option>
              </select>
            </label>

            <!-- HIDDEN: Selected plan from pricing buttons -->
            <input type="hidden" name="plan" id="selected-plan" value="free" />
            <div id="turnstile-container"></div>
            <!-- Turnstile - Invisible mode, auto-validates on submit attempt -->
            <div 
              class="cf-turnstile" 
              data-sitekey="0x4AAAAAACh0opVnevzeby3S65WWzoSwJOE"
              data-appearance="always"
              data-theme="dark"
            ></div>

            <!-- Error display -->
            <p id="error-message" style="color: #f97316; font-size: 0.85rem; margin: 8px 0; display: none;"></p>

            <button 
              type="submit" 
              class="ih-btn ih-btn-primary ih-btn-full" 
              id="submit-btn"
              disabled
            >
              Create free account →
            </button>

            <p class="ih-signup-footnote">
              By continuing, you agree to our
              <a href="/legal/terms">Terms</a> and
              <a href="/legal/privacy">Privacy Policy</a>.
            </p>

            <p class="ih-signup-login">
              Already using InsightHunter?
              <a href="/login">Log in</a>
            </p>
          </form>
        </div>
      </section>

      <!-- PRICING (unchanged - works with plan selection) -->
      <section class="ih-section" id="pricing">
        <header class="ih-section-header">
          <h2>Plans that grow with your business</h2>
          <p>
            Start free and upgrade as your client roster grows. Core features on every plan —
            no essential tools locked behind a paywall.
          </p>
        </header>

        <div class="ih-pricing-grid">
          <!-- Free -->
          <article class="ih-plan">
            <h3>Free</h3>
            <p class="ih-plan-price">$0</p>
            <p class="ih-plan-tagline">For owners getting their first financial cockpit.</p>
            <ul class="ih-plan-features">
              <li>Manual CSV uploads</li>
              <li>Basic compliance task tracking</li>
              <li>Up to 3 client profiles</li>
              <li>Standard report templates</li>
              <li>Email support</li>
            </ul>
            <button class="ih-btn ih-btn-outline ih-btn-full" data-plan="free">
              Start free
            </button>
          </article>

          <!-- Standard -->
          <article class="ih-plan ih-plan-featured">
            <div class="ih-plan-badge">Most popular</div>
            <h3>Standard</h3>
            <p class="ih-plan-price">$49<span>/mo</span></p>
            <p class="ih-plan-tagline">For firms ready to centralize compliance and reporting.</p>
            <ul class="ih-plan-features">
              <li>Automatic data ingestion</li>
              <li>Full compliance hub with smart reminders</li>
              <li>Up to 20 client profiles</li>
              <li>Engagement letter generation & tracking</li>
              <li>Branded client-ready report packs</li>
              <li>Priority support</li>
            </ul>
            <button class="ih-btn ih-btn-primary ih-btn-full" data-plan="standard">
              Try Standard
            </button>
          </article>

          <!-- Pro -->
          <article class="ih-plan">
            <h3>Pro</h3>
            <p class="ih-plan-price">$149<span>/mo</span></p>
            <p class="ih-plan-tagline">For fractional CFOs and multi-entity firms.</p>
            <ul class="ih-plan-features">
              <li>Everything in Standard</li>
              <li>Unlimited client profiles</li>
              <li>Multi-entity management</li>
              <li>White-label reporting</li>
              <li>Advanced automation workflows</li>
              <li>Dedicated account manager</li>
            </ul>
            <button class="ih-btn ih-btn-outline ih-btn-full" data-plan="pro">
              Talk to sales
            </button>
          </article>
        </div>
      </section>
    </main>

    <script>
      // 1. Plan selection (your existing code - perfect!)
      const planButtons = document.querySelectorAll("[data-plan]");
      const planInput = document.getElementById("selected-plan");
      const signupForm = document.querySelector(".ih-signup-card");

      planButtons.forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          const plan = btn.getAttribute("data-plan");
          if (planInput) planInput.value = plan;
          signupForm.scrollIntoView({ behavior: "smooth" });
        });
      });

      // 2. Turnstile integration - enable submit on success
      window.turnstileCallback = function(token) {
        document.getElementById('submit-btn').disabled = false;
        document.getElementById('submit-btn').textContent = `Create ${planInput.value} account →`;
      };

      // 3. Form submission with loading + error handling
      document.getElementById('signup-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const btn = document.getElementById('submit-btn');
        const errorMsg = document.getElementById('error-message');
        const formData = new FormData(this);
        
        // Get Turnstile token
        const turnstileToken = turnstile.getResponse(document.querySelector('.cf-turnstile'));
        if (!turnstileToken) {
          errorMsg.textContent = 'Please complete the verification.';
          errorMsg.style.display = 'block';
          return;
        }
        formData.append('cf-turnstile-response', turnstileToken);

        btn.disabled = true;
        btn.textContent = 'Creating account...';
        errorMsg.style.display = 'none';

        try {
          const response = await fetch('/api/signup', {
            method: 'POST',
            body: formData
          });

          if (response.ok) {
            // Redirect handled by Worker (302 to /shopping)
            window.location.href = '/shopping.html';
          } else {
            const error = await response.text();
            errorMsg.textContent = error || 'Signup failed. Try again.';
            errorMsg.style.display = 'block';
            btn.disabled = false;
            btn.textContent = `Create ${planInput.value} account →`;
            turnstile.reset(); // Reset Turnstile
          }
        } catch (err) {
          errorMsg.textContent = 'Network error. Check connection.';
          errorMsg.style.display = 'block';
          btn.disabled = false;
          btn.textContent = `Create ${planInput.value} account →`;
        }
      });
    </script>
  </body>
</html>
